# Open WebUI AI语音助手使用说明

## 🎯 功能概述

我们为Open WebUI添加了智能语音助手功能，支持：
- 🎤 **语音转文字**：将语音转录为文字并填入聊天框
- 🔧 **语音指令执行**：识别并执行系统指令（如"打开计算器"）
- 💬 **智能识别**：自动区分普通对话和系统指令

## 🚀 快速开始

### 1. 启动服务

确保以下服务正在运行：

```bash
# 启动语音API服务
python voice_api_server.py

# 启动Open WebUI (Docker)
docker-compose up -d
```

### 2. 访问Open WebUI

打开浏览器访问：http://localhost:8888

### 3. 注入AI语音助手脚本

由于Open WebUI的架构限制，需要手动注入我们的语音助手脚本：

1. **打开开发者工具**：按 `F12`
2. **切换到控制台**：点击 `Console` 标签
3. **复制脚本内容**：打开 `force_right_button.js` 文件，复制全部内容
4. **粘贴并运行**：在控制台中粘贴脚本并按回车执行

## 🎤 使用AI语音功能

### 语音按钮位置
注入脚本成功后，你会在页面**右下角**看到一个**紫色的圆形按钮**，显示"🎤 AI语音"。

### 录音操作
- **按住**按钮开始录音（按钮会变红并闪烁）
- **松开**按钮结束录音
- 系统会自动识别语音内容类型并处理

### 智能处理模式
1. **语音指令模式**：
   - 识别关键词：打开、启动、运行、计算器、记事本等
   - 自动执行系统指令
   - 显示执行结果

2. **对话模式**：
   - 普通对话内容转录为文字
   - 自动填入聊天输入框
   - 询问是否发送消息

### 状态指示
页面右上角会显示状态信息：
- 🎤 录音中...
- 🔄 处理中...
- 🔧 执行指令中...
- ✅ 已执行/文本已插入
- ❌ 错误信息

## 🔧 技术架构

### 服务组件
1. **语音API服务** (端口 8889)
   - Whisper语音识别
   - 音频处理
   - RESTful API接口

2. **Open WebUI** (端口 8888)
   - Docker容器运行
   - Web界面
   - 聊天功能

3. **语音增强脚本**
   - 浏览器端JavaScript
   - 语音录制
   - API调用
   - UI集成

### 数据流程
```
用户语音 → 浏览器录音 → 语音API → Whisper转录 → 文字结果 → 聊天输入框
```

## 🛠️ 故障排除

### 常见问题

#### 1. 看不到语音按钮
- 确认脚本已正确注入
- 检查浏览器控制台是否有错误
- 尝试刷新页面后重新注入脚本

#### 2. 录音失败
- 检查浏览器麦克风权限
- 确认麦克风设备正常工作
- 查看控制台错误信息

#### 3. 转录失败
- 确认语音API服务正在运行 (http://localhost:8889)
- 检查网络连接
- 查看API服务日志

#### 4. 文字无法插入聊天框
- 确认Open WebUI页面已完全加载
- 检查聊天输入框是否可见
- 尝试手动点击输入框后再使用语音功能

### 检查服务状态

```bash
# 检查语音API服务
curl http://localhost:8889/health

# 检查Open WebUI容器
docker ps | grep webui

# 查看API服务日志
# (在运行voice_api_server.py的终端中查看)
```

### 浏览器兼容性
- ✅ Chrome/Edge (推荐)
- ✅ Firefox
- ⚠️ Safari (可能需要额外权限设置)

## 📝 使用技巧

1. **录音环境**：在安静环境中录音效果更好
2. **语音清晰**：说话清晰、语速适中
3. **录音时长**：建议每次录音不超过30秒
4. **权限设置**：首次使用时允许浏览器访问麦克风

## 🔄 重新注入脚本

如果页面刷新后语音功能消失，重新执行以下步骤：
1. 按 `F12` 打开开发者工具
2. 在控制台中重新粘贴并运行 `inject_voice_script.js` 的内容

## 📞 技术支持

如果遇到问题，请检查：
1. 浏览器控制台错误信息
2. 语音API服务日志
3. Docker容器状态
4. 网络连接状态

---

**注意**：由于这是通过浏览器脚本注入的增强功能，每次刷新页面后都需要重新注入脚本。
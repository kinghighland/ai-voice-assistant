# ğŸ—ï¸ ç³»ç»Ÿè®¾è®¡æ–‡æ¡£

## é¡¹ç›®æ¦‚è¿°

### è®¾è®¡ç›®æ ‡
è®¾è®¡ä¸€ä¸ªé«˜æ€§èƒ½ã€æ˜“ç”¨ã€å¯æ‰©å±•çš„AIè¯­éŸ³åŠ©æ‰‹ç³»ç»Ÿï¼Œä¸ºOpen WebUIæä¾›æ™ºèƒ½è¯­éŸ³äº¤äº’èƒ½åŠ›ã€‚

### è®¾è®¡åŸåˆ™
- **æ¨¡å—åŒ–**: ç»„ä»¶è§£è€¦ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•
- **é«˜æ€§èƒ½**: å……åˆ†åˆ©ç”¨GPUåŠ é€Ÿï¼Œä¼˜åŒ–å“åº”æ—¶é—´
- **æ˜“ç”¨æ€§**: ç®€åŒ–éƒ¨ç½²å’Œä½¿ç”¨æµç¨‹
- **å¯é æ€§**: å¼‚å¸¸å¤„ç†å’Œé™çº§æ–¹æ¡ˆ
- **å®‰å…¨æ€§**: æœ¬åœ°å¤„ç†ï¼Œä¿æŠ¤ç”¨æˆ·éšç§

## ğŸ›ï¸ ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·å±‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æµè§ˆå™¨ (Chrome/Firefox/Edge)                               â”‚
â”‚  â”œâ”€â”€ Open WebUI (http://localhost:8888)                    â”‚
â”‚  â””â”€â”€ è¯­éŸ³åŠ©æ‰‹å‰ç«¯è„šæœ¬ (force_right_button.js)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                        ç½‘ç»œå±‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  HTTP/WebSocket é€šä¿¡                                        â”‚
â”‚  â”œâ”€â”€ CORS è·¨åŸŸæ”¯æŒ                                          â”‚
â”‚  â””â”€â”€ RESTful API æ¥å£                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                        åº”ç”¨å±‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è¯­éŸ³APIæœåŠ¡ (FastAPI)                                      â”‚
â”‚  â”œâ”€â”€ è¯­éŸ³è½¬å½•æ¨¡å—                                           â”‚
â”‚  â”œâ”€â”€ æ™ºèƒ½æŒ‡ä»¤è¯†åˆ«æ¨¡å—                                        â”‚
â”‚  â”œâ”€â”€ ç³»ç»ŸæŒ‡ä»¤æ‰§è¡Œæ¨¡å—                                        â”‚
â”‚  â””â”€â”€ AIå¯¹è¯æ¨¡å—                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                        AIæ¨¡å‹å±‚                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Whisper è¯­éŸ³è¯†åˆ«æ¨¡å‹                                       â”‚
â”‚  â”œâ”€â”€ large-v3 (æœ€ä½³è´¨é‡)                                    â”‚
â”‚  â”œâ”€â”€ medium (å¹³è¡¡é€‰æ‹©)                                      â”‚
â”‚  â””â”€â”€ base (å¿«é€Ÿå¯åŠ¨)                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                        ç³»ç»Ÿå±‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ“ä½œç³»ç»Ÿæ¥å£                                               â”‚
â”‚  â”œâ”€â”€ åº”ç”¨ç¨‹åºå¯åŠ¨                                           â”‚
â”‚  â”œâ”€â”€ ç½‘ç«™è®¿é—®                                               â”‚
â”‚  â””â”€â”€ ç³»ç»Ÿæ“ä½œ                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç»„ä»¶å…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    HTTP     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æµè§ˆå™¨     â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚  è¯­éŸ³API     â”‚
â”‚   å‰ç«¯è„šæœ¬   â”‚             â”‚   æœåŠ¡       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                             â”‚  Whisper     â”‚
                             â”‚   æ¨¡å‹       â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                             â”‚  ç³»ç»ŸæŒ‡ä»¤    â”‚
                             â”‚   æ‰§è¡Œå™¨     â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æ ¸å¿ƒæ¨¡å—è®¾è®¡

### 1. è¯­éŸ³è½¬å½•æ¨¡å—

#### 1.1 æ¨¡å—èŒè´£
- æ¥æ”¶éŸ³é¢‘æ–‡ä»¶
- è°ƒç”¨Whisperæ¨¡å‹è¿›è¡Œè½¬å½•
- ä¼˜åŒ–ä¸­æ–‡è¯†åˆ«å‡†ç¡®æ€§
- è¿”å›è½¬å½•ç»“æœ

#### 1.2 æŠ€æœ¯å®ç°
```python
class VoiceTranscriber:
    def __init__(self, model_name="large-v3", device="auto"):
        self.model = whisper.load_model(model_name, device=device)
        self.device = device
    
    def transcribe(self, audio_file):
        # ä¼˜åŒ–çš„è½¬å½•å‚æ•°
        result = self.model.transcribe(
            audio_file,
            language="zh",
            initial_prompt="ä»¥ä¸‹æ˜¯æ™®é€šè¯çš„è½¬å½•ï¼Œè¯·å‡†ç¡®è¯†åˆ«åº”ç”¨ç¨‹åºåç§°ã€‚",
            temperature=0.0,
            beam_size=5,
            best_of=5,
            fp16=torch.cuda.is_available()
        )
        return self.preprocess_text(result["text"])
    
    def preprocess_text(self, text):
        # ä¸­æ–‡è¯†åˆ«é”™è¯¯ä¿®æ­£
        corrections = {
            "è®¡æ—¶ç‰ˆ": "è®°äº‹æœ¬",
            "è®¡æ—¶å™¨": "è®¡ç®—å™¨",
            "è®¡ç®—æœº": "è®¡ç®—å™¨"
        }
        for wrong, correct in corrections.items():
            text = text.replace(wrong, correct)
        return text
```

#### 1.3 æ€§èƒ½ä¼˜åŒ–
- **GPUåŠ é€Ÿ**: è‡ªåŠ¨æ£€æµ‹CUDAï¼Œä¼˜å…ˆä½¿ç”¨GPU
- **æ¨¡å‹ç¼“å­˜**: æ¨¡å‹åŠ è½½åå¸¸é©»å†…å­˜
- **å‚æ•°ä¼˜åŒ–**: é’ˆå¯¹ä¸­æ–‡ä¼˜åŒ–çš„è½¬å½•å‚æ•°
- **é”™è¯¯ä¿®æ­£**: é¢„å¤„ç†å¸¸è§è¯†åˆ«é”™è¯¯

### 2. æ™ºèƒ½æŒ‡ä»¤è¯†åˆ«æ¨¡å—

#### 2.1 æ¨¡å—èŒè´£
- åˆ†æè½¬å½•æ–‡æœ¬
- è¯†åˆ«æŒ‡ä»¤ç±»å‹å’Œç›®æ ‡
- åŒºåˆ†æŒ‡ä»¤å’Œæ™®é€šå¯¹è¯
- è¿”å›è¯†åˆ«ç»“æœ

#### 2.2 æŒ‡ä»¤åˆ†ç±»ä½“ç³»
```python
COMMAND_PATTERNS = {
    "åº”ç”¨ç¨‹åº": {
        "keywords": ["æ‰“å¼€", "å¯åŠ¨", "è¿è¡Œ", "å¼€å¯"],
        "targets": {
            "è®°äº‹æœ¬": ["è®°äº‹æœ¬", "notepad", "æ–‡æœ¬ç¼–è¾‘å™¨"],
            "è®¡ç®—å™¨": ["è®¡ç®—å™¨", "calculator", "è®¡æ—¶å™¨", "è®¡ç®—æœº"],
            # ... æ›´å¤šåº”ç”¨
        }
    },
    "ç½‘ç«™": {
        "keywords": ["æ‰“å¼€", "è®¿é—®", "è¿›å…¥", "å»"],
        "targets": {
            "ç™¾åº¦": ["ç™¾åº¦", "baidu"],
            "è°·æ­Œ": ["è°·æ­Œ", "google", "æœç´¢"],
            # ... æ›´å¤šç½‘ç«™
        }
    },
    "ç³»ç»Ÿæ“ä½œ": {
        "keywords": ["å…³é—­", "é€€å‡º", "é”å±", "æˆªå›¾"],
        "targets": {
            "é”å±": ["é”å±", "lock", "é”å®šå±å¹•"],
            "æˆªå›¾": ["æˆªå›¾", "æˆªå±", "æŠ“å›¾"],
            # ... æ›´å¤šæ“ä½œ
        }
    }
}
```

#### 2.3 è¯†åˆ«ç®—æ³•
```python
def smart_command_detection(text: str) -> tuple[bool, str, str]:
    """æ™ºèƒ½æŒ‡ä»¤æ£€æµ‹"""
    text = preprocess_chinese_text(text.strip())
    text_lower = text.lower()
    
    # å¤šç»´åº¦æ£€æµ‹ï¼šå…³é”®è¯ + ç›®æ ‡ + ä¸Šä¸‹æ–‡
    for cmd_type, config in COMMAND_PATTERNS.items():
        keywords = config["keywords"]
        targets = config["targets"]
        
        # æ£€æŸ¥å…³é”®è¯
        has_keyword = any(keyword in text for keyword in keywords)
        
        if has_keyword:
            # æ£€æŸ¥ç›®æ ‡åŒ¹é…
            for target_name, target_aliases in targets.items():
                if any(alias in text_lower for alias in target_aliases):
                    return True, cmd_type, target_name
    
    return False, "", ""
```

### 3. ç³»ç»ŸæŒ‡ä»¤æ‰§è¡Œæ¨¡å—

#### 3.1 æ¨¡å—èŒè´£
- æ‰§è¡Œè¯†åˆ«å‡ºçš„ç³»ç»ŸæŒ‡ä»¤
- æä¾›æ‰§è¡Œç»“æœåé¦ˆ
- å¤„ç†æ‰§è¡Œå¼‚å¸¸
- å®‰å…¨æ§åˆ¶å’Œæƒé™ç®¡ç†

#### 3.2 æ‰§è¡Œå™¨è®¾è®¡
```python
class CommandExecutor:
    def __init__(self):
        self.system = platform.system().lower()
        self.safe_commands = self.load_safe_commands()
    
    def execute(self, cmd_type: str, target: str) -> Optional[str]:
        """æ‰§è¡ŒæŒ‡ä»¤"""
        if not self.is_safe_command(cmd_type, target):
            return "âŒ ä¸å®‰å…¨çš„æŒ‡ä»¤ï¼Œæ‹’ç»æ‰§è¡Œ"
        
        try:
            if cmd_type == "åº”ç”¨ç¨‹åº":
                return self.launch_application(target)
            elif cmd_type == "ç½‘ç«™":
                return self.open_website(target)
            elif cmd_type == "ç³»ç»Ÿæ“ä½œ":
                return self.system_operation(target)
        except Exception as e:
            return f"âŒ æ‰§è¡Œå¤±è´¥: {str(e)}"
    
    def is_safe_command(self, cmd_type: str, target: str) -> bool:
        """å®‰å…¨æ£€æŸ¥"""
        return (cmd_type, target) in self.safe_commands
```

#### 3.3 å®‰å…¨æœºåˆ¶
- **ç™½åå•æœºåˆ¶**: åªå…è®¸é¢„å®šä¹‰çš„å®‰å…¨æŒ‡ä»¤
- **æƒé™æ£€æŸ¥**: å±é™©æ“ä½œéœ€è¦ç”¨æˆ·ç¡®è®¤
- **å¼‚å¸¸å¤„ç†**: æ‰§è¡Œå¤±è´¥æ—¶æä¾›å‹å¥½æç¤º
- **æ—¥å¿—è®°å½•**: è®°å½•æ‰€æœ‰æŒ‡ä»¤æ‰§è¡Œæƒ…å†µ

### 4. WebUIé›†æˆæ¨¡å—

#### 4.1 å‰ç«¯è„šæœ¬è®¾è®¡
```javascript
class VoiceAssistant {
    constructor() {
        this.apiUrl = 'http://localhost:8889';
        this.isRecording = false;
        this.init();
    }
    
    init() {
        this.createButton();
        this.bindEvents();
        this.testConnection();
    }
    
    async processVoice(audioBlob) {
        // 1. ä¸Šä¼ éŸ³é¢‘è¿›è¡Œè½¬å½•
        const transcribeResult = await this.transcribe(audioBlob);
        
        // 2. æ ¹æ®åç«¯åˆ¤æ–­å¤„ç†æ–¹å¼
        if (transcribeResult.is_command) {
            await this.executeCommand(transcribeResult.transcribed_text);
        } else {
            this.insertToChat(transcribeResult.transcribed_text);
        }
    }
}
```

#### 4.2 é›†æˆç­–ç•¥
- **éä¾µå…¥å¼**: é€šè¿‡JavaScriptæ³¨å…¥ï¼Œä¸ä¿®æ”¹WebUIæºç 
- **å…¼å®¹æ€§**: æ”¯æŒå¤šç§æµè§ˆå™¨å’ŒWebUIç‰ˆæœ¬
- **ç”¨æˆ·ä½“éªŒ**: ç›´è§‚çš„æŒ‰é’®è®¾è®¡å’ŒçŠ¶æ€æç¤º
- **é”™è¯¯å¤„ç†**: ç½‘ç»œå¼‚å¸¸å’ŒAPIé”™è¯¯çš„å‹å¥½æç¤º

## ğŸ“Š æ•°æ®æµè®¾è®¡

### 1. è¯­éŸ³å¤„ç†æµç¨‹

```
ç”¨æˆ·è¯­éŸ³è¾“å…¥
      â”‚
      â–¼
æµè§ˆå™¨å½•éŸ³ (MediaRecorder)
      â”‚
      â–¼
éŸ³é¢‘æ•°æ® (Blob)
      â”‚
      â–¼
HTTP POST /transcribe
      â”‚
      â–¼
Whisperæ¨¡å‹è½¬å½•
      â”‚
      â–¼
ä¸­æ–‡é”™è¯¯ä¿®æ­£
      â”‚
      â–¼
æ™ºèƒ½æŒ‡ä»¤è¯†åˆ«
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æŒ‡ä»¤æ¨¡å¼   â”‚   å¯¹è¯æ¨¡å¼   â”‚
â–¼             â–¼
ç³»ç»ŸæŒ‡ä»¤æ‰§è¡Œ   æ–‡æœ¬æ’å…¥èŠå¤©æ¡†
â”‚             â”‚
â–¼             â–¼
æ‰§è¡Œç»“æœåé¦ˆ   ç”¨æˆ·ç¡®è®¤å‘é€
```

### 2. APIæ¥å£è®¾è®¡

#### 2.1 è½¬å½•æ¥å£
```
POST /transcribe
Content-Type: multipart/form-data

Request:
- audio_file: éŸ³é¢‘æ–‡ä»¶ (WAV/MP3/M4A)

Response:
{
    "success": true,
    "transcribed_text": "æ‰“å¼€è®°äº‹æœ¬",
    "language": "zh",
    "is_command": true,
    "command_type": "åº”ç”¨ç¨‹åº",
    "command_target": "è®°äº‹æœ¬",
    "confidence": 0.95
}
```

#### 2.2 æŒ‡ä»¤å¤„ç†æ¥å£
```
POST /process
Content-Type: application/json

Request:
{
    "text": "æ‰“å¼€è®°äº‹æœ¬",
    "execute_commands": true
}

Response:
{
    "transcribed_text": "æ‰“å¼€è®°äº‹æœ¬",
    "ai_response": "æˆ‘æ¥å¸®æ‚¨æ‰“å¼€è®°äº‹æœ¬",
    "command_executed": true,
    "command_result": "âœ… å·²ä¸ºæ‚¨æ‰“å¼€è®°äº‹æœ¬",
    "command_type": "åº”ç”¨ç¨‹åº"
}
```

### 3. æ•°æ®å­˜å‚¨è®¾è®¡

#### 3.1 æ¨¡å‹ç¼“å­˜
```
~/.cache/whisper/
â”œâ”€â”€ large-v3.pt      # 3.1GB
â”œâ”€â”€ medium.pt        # 1.5GB
â””â”€â”€ base.pt          # 142MB
```

#### 3.2 é…ç½®æ–‡ä»¶
```
.kiro/settings/
â”œâ”€â”€ voice_config.json    # è¯­éŸ³é…ç½®
â””â”€â”€ command_config.json  # æŒ‡ä»¤é…ç½®
```

#### 3.3 ä¸´æ—¶æ–‡ä»¶
```
/tmp/voice_assistant/
â”œâ”€â”€ audio_*.wav         # ä¸´æ—¶éŸ³é¢‘æ–‡ä»¶ (è‡ªåŠ¨æ¸…ç†)
â””â”€â”€ logs/              # æ—¥å¿—æ–‡ä»¶
```

## ğŸš€ éƒ¨ç½²æ¶æ„

### 1. æœ¬åœ°éƒ¨ç½²æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ç”¨æˆ·æœºå™¨                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Dockerå®¹å™¨                             â”‚
â”‚  â”œâ”€â”€ Open WebUI (ç«¯å£8888)              â”‚
â”‚  â””â”€â”€ æ•°æ®å·æŒ‚è½½                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Pythonè¿›ç¨‹                             â”‚
â”‚  â”œâ”€â”€ è¯­éŸ³APIæœåŠ¡ (ç«¯å£8889)             â”‚
â”‚  â”œâ”€â”€ Whisperæ¨¡å‹                        â”‚
â”‚  â””â”€â”€ ç³»ç»ŸæŒ‡ä»¤æ‰§è¡Œå™¨                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ“ä½œç³»ç»Ÿ                               â”‚
â”‚  â”œâ”€â”€ CUDAé©±åŠ¨ (å¯é€‰)                    â”‚
â”‚  â”œâ”€â”€ éŸ³é¢‘è®¾å¤‡                           â”‚
â”‚  â””â”€â”€ ç³»ç»Ÿåº”ç”¨ç¨‹åº                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æœåŠ¡å¯åŠ¨æµç¨‹

```
å¯åŠ¨è„šæœ¬ (simple_start.py)
      â”‚
      â–¼
ç¯å¢ƒæ£€æŸ¥ (GPU/ä¾èµ–)
      â”‚
      â–¼
æ¨¡å‹ä¸‹è½½/åŠ è½½
      â”‚
      â–¼
APIæœåŠ¡å¯åŠ¨
      â”‚
      â–¼
å¥åº·æ£€æŸ¥
      â”‚
      â–¼
æœåŠ¡å°±ç»ª
```

### 3. å®¹å™¨åŒ–éƒ¨ç½²

```yaml
# docker-compose.yml
version: '3.8'
services:
  open-webui:
    image: ghcr.io/open-webui/open-webui:main
    ports:
      - "8888:8080"
    volumes:
      - open-webui:/app/backend/data
      - ./static:/app/backend/static/custom
    
  voice-assistant:
    build: .
    ports:
      - "8889:8889"
    volumes:
      - ~/.cache/whisper:/root/.cache/whisper
    environment:
      - CUDA_VISIBLE_DEVICES=0
```

## ğŸ”’ å®‰å…¨è®¾è®¡

### 1. æ•°æ®å®‰å…¨
- **æœ¬åœ°å¤„ç†**: è¯­éŸ³æ•°æ®ä¸ä¸Šä¼ äº‘ç«¯
- **ä¸´æ—¶æ–‡ä»¶**: éŸ³é¢‘æ–‡ä»¶å¤„ç†åç«‹å³åˆ é™¤
- **å†…å­˜æ¸…ç†**: æ•æ„Ÿæ•°æ®åŠæ—¶æ¸…ç†
- **ä¼ è¾“åŠ å¯†**: HTTPSé€šä¿¡ (ç”Ÿäº§ç¯å¢ƒ)

### 2. ç³»ç»Ÿå®‰å…¨
- **æŒ‡ä»¤ç™½åå•**: åªå…è®¸å®‰å…¨çš„ç³»ç»Ÿæ“ä½œ
- **æƒé™æ§åˆ¶**: å±é™©æ“ä½œéœ€è¦ç”¨æˆ·ç¡®è®¤
- **æ²™ç®±æ‰§è¡Œ**: é™åˆ¶æŒ‡ä»¤æ‰§è¡Œæƒé™
- **å®¡è®¡æ—¥å¿—**: è®°å½•æ‰€æœ‰æŒ‡ä»¤æ‰§è¡Œ

### 3. ç½‘ç»œå®‰å…¨
- **CORSé…ç½®**: é™åˆ¶è·¨åŸŸè®¿é—®
- **è¾“å…¥éªŒè¯**: é˜²æ­¢æ³¨å…¥æ”»å‡»
- **é€Ÿç‡é™åˆ¶**: é˜²æ­¢APIæ»¥ç”¨
- **é”™è¯¯å¤„ç†**: ä¸æ³„éœ²æ•æ„Ÿä¿¡æ¯

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. æ¨¡å‹ä¼˜åŒ–
- **GPUåŠ é€Ÿ**: CUDAå¹¶è¡Œè®¡ç®—
- **æ¨¡å‹é‡åŒ–**: FP16ç²¾åº¦å‡å°‘å†…å­˜
- **æ‰¹å¤„ç†**: æ”¯æŒå¤šéŸ³é¢‘å¹¶è¡Œå¤„ç†
- **æ¨¡å‹ç¼“å­˜**: é¿å…é‡å¤åŠ è½½

### 2. ç½‘ç»œä¼˜åŒ–
- **è¿æ¥æ± **: å¤ç”¨HTTPè¿æ¥
- **å‹ç¼©ä¼ è¾“**: Gzipå‹ç¼©å“åº”
- **ç¼“å­˜ç­–ç•¥**: é™æ€èµ„æºç¼“å­˜
- **å¼‚æ­¥å¤„ç†**: éé˜»å¡IOæ“ä½œ

### 3. ç³»ç»Ÿä¼˜åŒ–
- **å†…å­˜ç®¡ç†**: åŠæ—¶é‡Šæ”¾ä¸ç”¨çš„èµ„æº
- **è¿›ç¨‹ä¼˜åŒ–**: åˆç†çš„è¿›ç¨‹å’Œçº¿ç¨‹é…ç½®
- **ç£ç›˜IO**: ä¼˜åŒ–æ–‡ä»¶è¯»å†™æ“ä½œ
- **ç›‘æ§å‘Šè­¦**: å®æ—¶æ€§èƒ½ç›‘æ§

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### 1. å•å…ƒæµ‹è¯•
- è¯­éŸ³è½¬å½•æ¨¡å—æµ‹è¯•
- æŒ‡ä»¤è¯†åˆ«æ¨¡å—æµ‹è¯•
- ç³»ç»Ÿæ‰§è¡Œæ¨¡å—æµ‹è¯•
- APIæ¥å£æµ‹è¯•

### 2. é›†æˆæµ‹è¯•
- ç«¯åˆ°ç«¯è¯­éŸ³å¤„ç†æµç¨‹
- WebUIé›†æˆæµ‹è¯•
- å¤šæµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•
- å¼‚å¸¸åœºæ™¯æµ‹è¯•

### 3. æ€§èƒ½æµ‹è¯•
- å¹¶å‘ç”¨æˆ·æµ‹è¯•
- é•¿æ—¶é—´è¿è¡Œæµ‹è¯•
- èµ„æºä½¿ç”¨ç›‘æ§
- å“åº”æ—¶é—´æµ‹è¯•

### 4. ç”¨æˆ·æµ‹è¯•
- å¯ç”¨æ€§æµ‹è¯•
- ç”¨æˆ·ä½“éªŒæµ‹è¯•
- å¤šè¯­è¨€ç¯å¢ƒæµ‹è¯•
- ä¸åŒç¡¬ä»¶é…ç½®æµ‹è¯•

## ğŸ“ ç»´æŠ¤å’Œç›‘æ§

### 1. æ—¥å¿—ç³»ç»Ÿ
```python
# æ—¥å¿—é…ç½®
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('voice_assistant.log'),
        logging.StreamHandler()
    ]
)
```

### 2. å¥åº·æ£€æŸ¥
```python
@app.get("/health")
async def health_check():
    return {
        "status": "healthy",
        "whisper_loaded": whisper_model is not None,
        "device": "GPU" if torch.cuda.is_available() else "CPU",
        "timestamp": datetime.now().isoformat()
    }
```

### 3. æ€§èƒ½ç›‘æ§
- CPU/å†…å­˜ä½¿ç”¨ç‡
- GPUä½¿ç”¨ç‡ (å¦‚æœæœ‰)
- APIå“åº”æ—¶é—´
- é”™è¯¯ç‡ç»Ÿè®¡

### 4. è‡ªåŠ¨åŒ–è¿ç»´
- æœåŠ¡è‡ªåŠ¨é‡å¯
- æ—¥å¿—è½®è½¬
- æ¨¡å‹æ›´æ–°
- é…ç½®çƒ­æ›´æ–°

---

*æœ¬è®¾è®¡æ–‡æ¡£å°†éšç€é¡¹ç›®å‘å±•æŒç»­æ›´æ–°å’Œå®Œå–„*